{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "db29125e_239e0979",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T15:00:01Z",
      "side": 1,
      "message": "thanks for doing this! Overall looks good, just some minor nits about style/case",
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1e2d8fdb_84eba880",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 17,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:40:59Z",
      "side": 1,
      "message": "Capital R",
      "range": {
        "startLine": 17,
        "startChar": 3,
        "endLine": 17,
        "endChar": 4
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "363973c6_dacabdde",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 94,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:58:58Z",
      "side": 1,
      "message": "nit: could just capture the stdout of the inflation command as a bytes object, and pass it to the stdin of cpio command, then we would be able to drop this temp file, and drop the \"shell\u003dTrue\" option",
      "range": {
        "startLine": 94,
        "startChar": 7,
        "endLine": 94,
        "endChar": 29
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bad282a9_97ae0506",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 101,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:40:59Z",
      "side": 1,
      "message": "nit (very low priority): Could try different commands (gzip, gunzip, minigzip) until one of them succeeded? We would need to do this if we want to support the use case of downloading and running this script alone (out-of-tree)?",
      "range": {
        "startLine": 101,
        "startChar": 34,
        "endLine": 101,
        "endChar": 42
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "07455576_a2a43acd",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 101,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:53:44Z",
      "side": 1,
      "message": "it just hit my head that with the current design (cheers!), this would be very easy to implement, we could do this\n\n[(RamdiskFormat.LZ4, \u0027lz4\u0027),\n(RamdiskFormat.GZIP, \u0027minigzip\u0027),\n(RamdiskFormat.GZIP, \u0027gzip\u0027)]\n\nand the rest of the code should do its thing.",
      "parentUuid": "bad282a9_97ae0506",
      "range": {
        "startLine": 101,
        "startChar": 34,
        "endLine": 101,
        "endChar": 42
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "123707f4_a3c5cf26",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 101,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2021-02-04T15:35:41Z",
      "side": 1,
      "message": "\u003e and running this script alone (out-of-tree)?\n\nActually this is my plan (sorry, forgot to mention this in advance).\n\nCurrently \u0027lz4\u0027, \u0027minigzip\u0027, \u0027mkbootfs\u0027, \u0027mkbootimg\u0027 and \u0027toybox\u0027 are all in the otatools.zip (under otatools/bin/.*), which is built by `make otatools-package`.\n\nFor the out-of-tree use case, the plan is to\n1) download the otatools.zip\n2) unzip it, and export/append ./otatoolz/bin/ to $PATH\n\nAfter that, we can use \u0027repack_bootimg\u0027 in a standalone manner. (that\u0027s actually how our offline signing process works).\n\nI\u0027ll send another CL to include \u0027repack_bootimg\u0027 into \u0027INTERNAL_OTATOOLS_MODULES\u0027, so it will be included into otatools.zip.\n\nhttps://cs.android.com/android/platform/superproject/+/master:build/make/core/Makefile;l\u003d4061;drc\u003d3608148612c3392b52ff5df2529ebfee597b538d\n\nAs \u0027minigzip\u0027 is already in otatools.zip, we probably don\u0027t need to try \u0027gzip\u0027 ?",
      "parentUuid": "07455576_a2a43acd",
      "range": {
        "startLine": 101,
        "startChar": 34,
        "endLine": 101,
        "endChar": 42
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e230d0c_b5a3d5a8",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 103,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:53:44Z",
      "side": 1,
      "message": ".format",
      "range": {
        "startLine": 103,
        "startChar": 50,
        "endLine": 103,
        "endChar": 53
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d77dbd2a_5a0c3d2b",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 116,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2021-02-04T12:25:47Z",
      "side": 1,
      "message": "Switched to \u0027toybox cpio\u0027 in patch-set-2, instead of just \u0027cpip\u0027.",
      "range": {
        "startLine": 116,
        "startChar": 32,
        "endLine": 116,
        "endChar": 43
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ce152f9_578eaad1",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 116,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:40:59Z",
      "side": 1,
      "message": "I think just \"cpio\" is alright.\nWe don\u0027t really care which cpio implementation we\u0027re using (do we?), it just happen so that our in-tree cpio command is provided by toybox, hence we add \"required: [\"toybox\"]\" to the Android.bp.",
      "parentUuid": "d77dbd2a_5a0c3d2b",
      "range": {
        "startLine": 116,
        "startChar": 32,
        "endLine": 116,
        "endChar": 43
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2a641185_707d30b4",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 116,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2021-02-04T15:35:41Z",
      "side": 1,
      "message": "I used \u0027toybox cpip\u0027 because it\u0027s in the otatools.zip (for out-of-tree use case).\n\n\u003e it just happen so that our in-tree cpio command is provided by toybox,\n\nThat seems not the case. I tried `whereis cpio` but the path is not within the Android tree.",
      "parentUuid": "2ce152f9_578eaad1",
      "range": {
        "startLine": 116,
        "startChar": 32,
        "endLine": 116,
        "endChar": 43
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a85dd93_6fcf213f",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 116,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T15:49:41Z",
      "side": 1,
      "message": "Oh you\u0027re right! Interesting... Our host toybox is configured to support `cpio` and our build system uses this symlink (https://cs.android.com/android/platform/superproject/+/master:prebuilts/build-tools/path/linux-x86/cpio;bpv\u003d0). But I suppose, based on your findings, the \"prebuilts/build-tools/path/linux-x86/\" directory is not exposed to $PATH",
      "parentUuid": "2a641185_707d30b4",
      "range": {
        "startLine": 116,
        "startChar": 32,
        "endLine": 116,
        "endChar": 43
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7cadff22_97fd3162",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 127,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:46:00Z",
      "side": 1,
      "message": "\u0027\u0027",
      "range": {
        "startLine": 125,
        "startChar": 22,
        "endLine": 127,
        "endChar": 56
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "313bc6d4_015606b9",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 129,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:40:59Z",
      "side": 1,
      "message": "ditto",
      "range": {
        "startLine": 125,
        "startChar": 16,
        "endLine": 129,
        "endChar": 58
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d530f1fc_580d4f2c",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 129,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:46:00Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "313bc6d4_015606b9",
      "range": {
        "startLine": 125,
        "startChar": 16,
        "endLine": 129,
        "endChar": 58
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10ec7973_4fab0eaa",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 150,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:40:59Z",
      "side": 1,
      "message": "why are you changing this? throughout the file the string style have been \u0027\u0027 for ordinary string, \"\"\"\"\"\" for docstring. Is there any reason to make this exception?",
      "range": {
        "startLine": 147,
        "startChar": 8,
        "endLine": 150,
        "endChar": 0
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "45f2575c_ee7bb39c",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 150,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:46:00Z",
      "side": 1,
      "message": "Oh just realized the \u0027{}\u0027 within the string, that must be a valid reason. For this one (L149) I think it\u0027s alright, but (L147) should be \u0027\u0027",
      "parentUuid": "10ec7973_4fab0eaa",
      "range": {
        "startLine": 147,
        "startChar": 8,
        "endLine": 150,
        "endChar": 0
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4e636986_90121f80",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 150,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2021-02-04T15:35:41Z",
      "side": 1,
      "message": "Yup, my preference is using \u0027str\u0027, but \u0027{}\u0027 forces me to use double-quote instead.\n\nAgree that L147 can keep using single quote, as there is no \u0027{}\u0027.\n\n\nWill change that in next PS.",
      "parentUuid": "45f2575c_ee7bb39c",
      "range": {
        "startLine": 147,
        "startChar": 8,
        "endLine": 150,
        "endChar": 0
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "280da84b_6b50e880",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 180,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:40:59Z",
      "side": 1,
      "message": "ditto",
      "range": {
        "startLine": 180,
        "startChar": 14,
        "endLine": 180,
        "endChar": 16
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "63f46cf1_1e83d836",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 180,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:46:00Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "280da84b_6b50e880",
      "range": {
        "startLine": 180,
        "startChar": 14,
        "endLine": 180,
        "endChar": 16
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fbeeb838_9de752b9",
        "filename": "repack_bootimg.py",
        "patchSetId": 2
      },
      "lineNbr": 277,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-02-04T14:40:59Z",
      "side": 1,
      "message": "a list (consistent case)",
      "range": {
        "startLine": 277,
        "startChar": 31,
        "endLine": 277,
        "endChar": 32
      },
      "revId": "a9bb474e5ca37ec0885a06699c3f1763088c3948",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}